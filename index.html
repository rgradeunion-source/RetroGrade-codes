<!DOCTYPE html>
<html>
<head>
<title>My Game Codes</title>
<style>
button { margin: 5px; }
</style>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
</head>
<body>
<h1>Access Your Codes</h1>
<input id="email" placeholder="Enter your order email">
<button onclick="loadCodes()">Login</button>
<div id="codes"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBa-jKP7FsN2eeCDhRLumZiumHHEtXtZqg",
  authDomain: "retrogradecodes.firebaseapp.com",
  projectId: "retrogradecodes"
};
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

async function loadCodes() {
  const email = document.getElementById('email').value.trim().toLowerCase();
  const ordersDoc = await db.collection('orders').doc(email).get();
  if (!ordersDoc.exists) {
    document.getElementById('codes').innerHTML = "No orders found.";
    return;
  }
  const games = ordersDoc.data().games || [];
  let html = "";
  for (const game of games) {
    const codeDoc = await db.collection('codes').doc(game).get();
    const code = codeDoc.exists ? codeDoc.data().code : "Not available";
    html += `<div>
      <strong>${game}</strong>: ${code}
      <button onclick="copyCode('${code}')">Copy</button>
      <button onclick="refreshCode('${game}')">Refresh</button>
    </div>`;
  }
  document.getElementById('codes').innerHTML = html;
}

function copyCode(code) {
  navigator.clipboard.writeText(code);
  alert("Copied!");
}

async function refreshCode(game) {
  const codeDoc = await db.collection('codes').doc(game).get();
  const code = codeDoc.exists ? codeDoc.data().code : "Not available";
  alert(`Refreshed code: ${code}`);
}
</script>
</body>
</html>
