<input type="email" id="emailInput" placeholder="Enter your email" />
<button id="viewBtn">View My Codes</button>
<button id="refreshBtn" disabled>Refresh Codes ðŸ”„</button>

<div id="codesOutput"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let currentEmail = "";

  async function fetchCodes(email) {
    const docRef = doc(db, "codes", email);
    const docSnap = await getDoc(docRef);
    const output = document.getElementById("codesOutput");
    output.innerHTML = "";

    if (docSnap.exists()) {
      const data = docSnap.data();
      for (const [order, code] of Object.entries(data)) {
        const div = document.createElement("div");
        div.className = "code-box";
        div.innerHTML = `<strong>Order #${order}</strong>: ${code} <button onclick="navigator.clipboard.writeText('${code}')">Copy</button>`;
        output.appendChild(div);
      }
    } else {
      output.innerHTML = "No codes found for this email.";
    }
  }

  document.getElementById("viewBtn").addEventListener("click", () => {
    const email = document.getElementById("emailInput").value.trim().toLowerCase();
    if (!email) return alert("Please enter your email.");
    currentEmail = email;
    fetchCodes(email);
    document.getElementById("refreshBtn").disabled = false;
  });

  document.getElementById("refreshBtn").addEventListener("click", () => {
    if (!currentEmail) return alert("Please enter your email first.");
    fetchCodes(currentEmail);
  });
</script>
